<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>MaliApp Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
body{margin:0;font-family:Arial;background:#111;color:#fff;}
.box{max-width:420px;margin:25px auto;background:#222;border-radius:16px;padding:20px;}
input,button{width:100%;padding:12px;margin:8px 0;border-radius:8px;border:none;}
button{background:#00c853;font-weight:bold;cursor:pointer;}
.task{background:#333;padding:12px;border-radius:10px;margin:8px 0;display:flex;justify-content:space-between;align-items:center;}
 .match-card{
  background: linear-gradient(145deg,#1e1e1e,#2a2a2a);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 6px 16px rgba(0,0,0,.4);
}


.match-time{
  font-size:12px;
  background:#111;
  padding:4px 8px;
  border-radius:6px;
  opacity:.8;
}

.bet-buttons{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-top:10px;
}

.bet-btn{
  background:#111;
  border:1px solid #333;
  border-radius:10px;
  padding:10px;
  font-size:16px;
  font-weight:bold;
  color:#fff;
  transition:.2s;
}

.bet-btn:hover{
  background:#00c853;
  color:#000;
}

.bet-btn:disabled{
  opacity:.4;
  cursor:not-allowed;
}
  .bet-btn.selected{
  background:#00e676;
  color:#000;
}
  .bet-status{
  margin-top:6px;
  font-weight:bold;
  font-size:14px;
}

.bet-win{
  color:#00e676;
}

.bet-lose{
  color:#ff5252;
}

.bet-pending{
  color:#ffc107;
}

.badge{
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
}
  .section-title{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin:18px 0 12px;
  padding-bottom:10px;
  border-bottom:1px solid #2f2f2f;
}

.title-left{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:18px;
  font-weight:700;
}

.title-left i{
  color:#00e676;
  font-size:20px;
}

.live-dot{
  font-size:11px;
  font-weight:bold;
  color:#000;
  background:#ff1744;
  padding:4px 8px;
  border-radius:20px;
  animation:pulse 1.5s infinite;
}

@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(255,23,68,.6);}
  70%{box-shadow:0 0 0 10px rgba(255,23,68,0);}
  100%{box-shadow:0 0 0 0 rgba(255,23,68,0);}
}
 .pro-time{
  display:flex;
  align-items:center;
  gap:8px;
  font-size:14px;
  background:#111;
  padding:6px 10px;
  border-radius:10px;
  width:fit-content;
  margin-top:8px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,.05);
}

.pro-time i{
  color:#00e676;
  font-size:15px;
}

.time-text{
  opacity:.85;
}

.time-sep{
  opacity:.4;
}

.time-hour{
  font-weight:bold;
  letter-spacing:.5px;
} 
  .back-btn{
  background: linear-gradient(145deg,#1e1e1e,#2b2b2b);
  color:#fff;
  border:1px solid #333;
  border-radius:12px;
  padding:12px 16px;
  font-size:15px;
  font-weight:600;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  cursor:pointer;
  transition:.25s;
}

.back-btn i{
  font-size:16px;
  color:#00e676;
}

.back-btn:hover{
  background:#00e676;
  color:#000;
}

.back-btn:hover i{
  color:#000;
}
  .upgrade-btn{
  background:linear-gradient(135deg,#7c4dff,#651fff);
  border:none;
  padding:12px;
  color:white;
  width:100%;
  border-radius:10px;
  font-weight:bold;
  margin-top:10px;
}

.upgrade-title{
  text-align:center;
  color:#ffd54f;
  margin-bottom:15px;
}

.upgrade-cards{
  display:grid;
  gap:15px;
}

.upgrade-card{
  background:#1e1e2f;
  border-radius:14px;
  padding:15px;
  text-align:center;
  box-shadow:0 0 15px rgba(0,0,0,.4);
}

.upgrade-card h4{
  color:#fff;
}

.upgrade-card button{
  margin-top:10px;
  width:100%;
  padding:10px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  cursor:pointer;
}

.level-1 button{background:#00c853;color:#000;}
.level-2 button{background:#2979ff;color:#fff;}
.level-3 button{background:#ffab00;color:#000;}
  .level-box{
  display:flex;
  align-items:center;
  gap:14px;
  background:linear-gradient(135deg,#1c1c2b,#222);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 6px 18px rgba(0,0,0,.4);
}

.level-icon{
  font-size:32px;
  background:linear-gradient(135deg,#ffd54f,#ffb300);
  color:#000;
  width:52px;
  height:52px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
}

.level-number{
  font-weight:800;
  font-size:15px;
  letter-spacing:1px;
}

.level-name{
  font-size:13px;
  opacity:.8;
  margin-top:2px;
}

.level-bar{
  height:6px;
  background:#111;
  border-radius:10px;
  overflow:hidden;
  margin-top:6px;
}

.level-bar span{
  display:block;
  height:100%;
  background:linear-gradient(90deg,#00e676,#00c853);
  width:20%;
  transition:.3s;
}

  .balance-card{
  display:flex;
  align-items:center;
  gap:14px;
  background:linear-gradient(135deg,#1e1e1e,#2b2b2b);
  padding:14px 16px;
  border-radius:16px;
  box-shadow:0 8px 18px rgba(0,0,0,.4);
  margin-bottom:12px;
}

.balance-card i{
  font-size:26px;
  color:#00e676;
}

.balance-info{
  display:flex;
  flex-direction:column;
}

.balance-label{
  font-size:12px;
  opacity:.7;
}

.balance-value{
  font-size:22px;
  font-weight:800;
  letter-spacing:.5px;
}

.balance-value small{
  font-size:12px;
  margin-left:6px;
  opacity:.6;
}
  .topup-btn{
  background:linear-gradient(135deg,#00e676,#00c853);
  border:none;
  padding:12px;
  border-radius:14px;
  font-weight:800;
  font-size:15px;
  color:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  cursor:pointer;
  box-shadow:0 6px 14px rgba(0,230,118,.4);
}
 .topup-card{
  background:#1e1e2f;
  border-radius:18px;
  padding:18px;
  text-align:center;
  box-shadow:0 0 20px rgba(0,0,0,.5);
}

.qr{
  width:180px;
  border-radius:14px;
  margin-bottom:12px;
}

.wallet-address{
  background:#111;
  padding:10px;
  border-radius:10px;
  font-size:13px;
  word-break:break-all;
  margin-bottom:10px;
}

.copy-btn{
  background:#2979ff;
  border:none;
  padding:10px;
  width:100%;
  border-radius:10px;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

.warning{
  font-size:12px;
  color:#ffab00;
  margin-top:10px;
} 


.nav-item{
  display:flex;
  flex-direction:column;
  align-items:center;
  font-size:11px;
  color:#aaa;
  cursor:pointer;
  transition:.2s;
}

.nav-item i{
  font-size:20px;
  margin-bottom:4px;
}

.nav-item.active{
  color:#00e676;
}

.nav-item.active i{
  color:#00e676;
}
  body{
  padding-bottom:70px;
}
  /* ===== PROFILE ===== */
.profile-header{
  display:flex;
  gap:14px;
  align-items:center;
  margin-bottom:18px;
}

.avatar{
  width:64px;
  height:64px;
  border-radius:50%;
  background:linear-gradient(135deg,#00e676,#00c853);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  color:#000;
}

.profile-info{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.profile-name{
  font-weight:800;
  font-size:17px;
}

.profile-id{
  font-size:12px;
  opacity:.6;
}

.profile-level{
  font-size:13px;
  color:#ffd54f;
  display:flex;
  align-items:center;
  gap:6px;
}

.profile-stats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-bottom:18px;
}

.stat{
  background:#1e1e1e;
  border-radius:12px;
  padding:12px;
  text-align:center;
}

.stat-number{
  font-size:18px;
  font-weight:800;
  display:block;
}

.stat-label{
  font-size:11px;
  opacity:.6;
}

.profile-actions{
  display:grid;
  gap:10px;
}

.profile-actions button{
  background:#111;
  border:1px solid #333;
  border-radius:12px;
  padding:12px;
  color:#fff;
  font-weight:700;
  display:flex;
  align-items:center;
  gap:10px;
}

.profile-actions button i{
  color:#00e676;
}

.profile-actions .danger{
  background:#2b1111;
  border-color:#ff5252;
}

.profile-actions .danger i{
  color:#ff5252;
}

.bottom-bar{
  position: fixed;
  bottom: 12px;
  left: 50%;
  transform: translateX(-50%);
  width: calc(100% - 24px);
  max-width: 500px;
  height: 70px;

  background: rgba(20,20,20,0.9);
  backdrop-filter: blur(12px);
  border-radius: 24px;

  display: flex;
  justify-content: space-around;
  align-items: center;

  box-shadow: 0 15px 40px rgba(0,0,0,0.5);
  z-index: 999;
}

.bottom-bar button{
  background: none;
  border: none;
  color: #aaa;
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 11px;
  cursor: pointer;
  transition: 0.3s;
}

.bottom-bar button i{
  font-size: 20px;
  margin-bottom: 4px;
}

/* â­ Ø§Ù„Ø²Ø± Ø§Ù„Ø£ÙˆØ³Ø· */
.center-btn{
  width: 56px;          /* ÙƒØ§Ù† 64 */
  height: 56px;         /* ÙƒØ§Ù† 64 */
  border-radius: 50%;
  background: linear-gradient(135deg,#00e676,#00c853);
  color: #000 !important;

  display: flex;
  align-items: center;
  justify-content: center;

  position: relative;
top: -6px;
  box-shadow: 0 10px 22px rgba(0,230,118,.5);
  transition: 0.3s;
}

.center-btn i{
  font-size: 22px;      /* ÙƒØ§Ù† 26 */
}

.center-btn:active{
  transform: scale(0.92);
}
  .hidden{
  display: none !important;
}

/* ØªÙØ¹ÙŠÙ„ */
.bottom-bar button.active:not(.center-btn){
  color:#f5c26b;
}

.share-btn{
  margin-top: 10px;
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  background: linear-gradient(135deg,#22d3ee,#38bdf8);
  border: none;
  color: #020617;
  font-weight: bold;
}
.referral-box{
  display:flex;
  gap:8px;
  margin-top:8px;
}

.referral-box input{
  flex:1;
  background:#0f172a;
  border:1px solid rgba(255,255,255,.15);
  color:#fff;
  padding:8px;
  border-radius:8px;
}

.referral-box button{
  background:#38bdf8;
  border:none;
  color:#000;
  padding:8px 12px;
  border-radius:8px;
  font-weight:bold;
}
 
  .section-title-text{
  font-size:15px;
  font-weight:700;
  letter-spacing:.3px;
}

.section-subtext{
  font-size:12px;
  opacity:.65;
  margin-top:4px;
}
  .bet-card{
  background: linear-gradient(145deg,#1c1c1c,#262626);
  border-radius:16px;
  padding:14px;
  margin-bottom:14px;
  box-shadow:0 8px 18px rgba(0,0,0,.45);
  border-left:4px solid transparent;
}

.bet-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:12px;
}

.bet-match{
  font-weight:800;
  font-size:14px;
}

.bet-status{
  font-size:12px;
  padding:4px 10px;
  border-radius:20px;
  font-weight:bold;
}

/* BODY */
.bet-body{
  display:flex;
  justify-content:space-between;
}

.bet-item{
  display:flex;
  flex-direction:column;
  gap:4px;
}

.bet-item .label{
  font-size:11px;
  opacity:.6;
}

.bet-item .value{
  font-size:14px;
  font-weight:700;
}

/* Ø§Ù„Ø­Ø§Ù„Ø§Øª */
.bet-pending{
  border-left-color:#ffc107;
}
.bet-pending .bet-status{
  background:#ffc107;
  color:#000;
}

.bet-win{
  border-left-color:#00e676;
}
.bet-win .bet-status{
  background:#00e676;
  color:#000;
}

.bet-lose{
  border-left-color:#ff5252;
}
.bet-lose .bet-status{
  background:#ff5252;
  color:#fff;
}
  .level-card{
  background:#111;
  border-radius:12px;
  padding:15px;
  margin-bottom:12px;
  border:1px solid #222;
}

.level-card h4{
  margin:0 0 8px;
}

.level-card .price{
  color:#f0c040;
  font-weight:bold;
}

.level-card .tag{
  display:inline-block;
  margin-top:8px;
  font-size:12px;
  opacity:.8;
}

.level-card.active{
  border:1px solid #4caf50;
}

.level-card.coming,
.level-card.locked{
  opacity:.5;
}
  .success-box {
  background: linear-gradient(135deg, #1abc9c, #16a085);
  color: #fff;
  padding: 20px;
  border-radius: 12px;
  text-align: center;
  animation: fadeIn 0.4s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to   { opacity: 1; transform: scale(1); }
}


.withdraw-history {
  background: #111;
  border-radius: 14px;
  padding: 14px;
}

.withdraw-item {
  background: #1a1a1a;
  border-radius: 12px;
  padding: 12px 14px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,.35);
  border-left: 5px solid transparent;
  transition: transform .2s ease, box-shadow .2s ease;
}

.withdraw-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 14px rgba(0,0,0,.45);
}

/* ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº */
.withdraw-item .amount {
  font-weight: 700;
  font-size: 15px;
  color: #fff;
}

/* ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® */
.withdraw-item small {
  display: block;
  margin-top: 4px;
  font-size: 12px;
  color: #aaa;
}

/* ğŸ”¹ Ø§Ù„Ø­Ø§Ù„Ø© */
.withdraw-status {
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
  white-space: nowrap;
}

/* â³ pending */
.withdraw-item.pending {
  border-left-color: #f6c343;
}
.withdraw-item.pending .withdraw-status {
  background: rgba(246,195,67,.15);
  color: #f6c343;
}

/* âœ… approved */
.withdraw-item.approved {
  border-left-color: #38d39f;
}
.withdraw-item.approved .withdraw-status {
  background: rgba(56,211,159,.15);
  color: #38d39f;
}

/* âŒ rejected */
.withdraw-item.rejected {
  border-left-color: #ff6b6b;
}
.withdraw-item.rejected .withdraw-status {
  background: rgba(255,107,107,.15);
  color: #ff6b6b;
}
  .withdraw-history h4 {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
}

.withdraw-history h4 i {
  color: #f0b90b; /* Ø£ØµÙØ± Binance */
}
  .topup-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.topup-btn i {
  font-size: 16px;
}
  .topup-card p i {
  margin-left: 6px;
  color: #22c55e; /* Ø£Ø®Ø¶Ø± Ù…Ø§Ù„ÙŠ */
}
  .withdraw-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #111827;
  border-radius: 12px;
  padding: 12px 14px;
  margin-bottom: 10px;
}

.withdraw-left .amount {
  font-weight: 600;
  font-size: 15px;
}

.withdraw-left .amount i {
  margin-left: 6px;
  color: #f59e0b;
}

.withdraw-left .date {
  display: block;
  font-size: 12px;
  opacity: 0.7;
  margin-top: 4px;
}

.withdraw-left .date i {
  margin-left: 4px;
}

.withdraw-status {
  font-weight: 600;
  font-size: 13px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.withdraw-status.approved {
  color: #22c55e;
}

.withdraw-status.rejected {
  color: #ef4444;
}

.withdraw-status.pending {
  color: #f59e0b;
}
.withdraw-agree-center{
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;

  width: 100%;
  margin: 25px 0;

  direction: rtl;
  text-align: right;
}

/* ğŸ”¥ Ø£Ù‡Ù… Ø³Ø·Ø± ÙÙŠ Ø§Ù„Ø­Ù„ */
.withdraw-agree-center input{
  width: auto !important;
  padding: 0;
  margin: 0;
  flex-shrink: 0;
  accent-color: #f5b301;
}

.withdraw-agree-center label{
  white-space: nowrap;
  font-size: 14px;
  cursor: pointer;
}
  .reward-box,
.price-box {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  border-radius: 12px;
  margin-top: 10px;
  font-weight: 700;
  font-size: 15px;
  box-shadow: 0 6px 18px rgba(0,0,0,.12);
}

/* ğŸ’° Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ */
 .reward-box {
  background: #0f172a;
  color: #22c55e;
  border: 1px solid #22c55e;
}

.reward-box i {
  color: #22c55e;
}

.price-box {
  background: #020617;
  color: #38bdf8;
  border: 1px solid #38bdf8;
}

.price-box i {
  color: #38bdf8;
} 
 /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„Ø¹Ø§Ù… */
#rewardsBox .level-card {
  background: #020617;
  border: 1px solid #1e293b;
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 15px;
}

/* Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† */
#rewardsBox h4 {
  color: #38bdf8;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Ù†Øµ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª */
#rewardsBox p {
  color: #cbd5f5;
  margin: 6px 0;
}

/* Ø§Ù„Ø£Ø±Ù‚Ø§Ù… (USD) */
#rewardsBox strong {
  color: #22c55e;
}

/* Ø§Ù„Ø¯Ø¹ÙˆØ§Øª Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø© */
#activeInvites {
  color: #facc15;
}

/* Ø¬Ø§Ø¦Ø²Ø© 100 USD */
#rewardsBox .level-card:nth-of-type(2) h4 {
  color: #facc15;
}

/* Ø§Ù„ØªÙ‚Ø¯Ù… */
#inviteProgress {
  color: #38bdf8;
}

/* Ø²Ø± ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯ */
#claimBigReward {
  background: #020617;
  border: 1px solid #334155;
  color: #94a3b8;
  border-radius: 10px;
  padding: 10px;
  width: 100%;
  cursor: not-allowed;
} 
 #rewardsBox h4 i {
  margin-left: 6px;
  color: #38bdf8;
} 
.match-header {
  display: grid;
  grid-template-columns: 1fr auto 1fr; /* ğŸ‘ˆ Ø³Ø±Ù‘ Ø§Ù„Ø­Ù„ */
  align-items: center;
  width: 100%;
  padding: 12px 0;
  position: relative;
}

.match-header::before {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  height: 1px;
  background: rgba(34, 197, 94, 0.15);
}

.match-header .team {
  color: #22c55e;
  font-weight: 700;
  font-size: 16px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
}

.match-header .team:first-child {
  text-align: right;
  padding-right: 12px;
}

.match-header .team:last-child {
  text-align: left;
  padding-left: 12px;
}

.match-header .vs {
  font-size: 13px;
  font-weight: 800;
  color: #22c55e;
  background: #0f172a;
  padding: 4px 14px;
  border-radius: 6px;
  letter-spacing: 1px;
  z-index: 2;
}
 .match-header .team {
  min-width: 0;
} 
  .profile-logout{
  width: 100%;
  margin: 35px 0 10px;
  display: flex;
  justify-content: center;
}

.logout-btn{
  width: 90%;
  max-width: 320px;

  background: linear-gradient(135deg, #e53935, #c62828);
  color: #fff;

  border: none;
  border-radius: 14px;
  padding: 14px 18px;

  font-size: 15px;
  font-weight: 600;

  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;

  cursor: pointer;
  transition: all 0.25s ease;
}

.logout-btn i{
  font-size: 16px;
}

.logout-btn:hover{
  opacity: 0.9;
  transform: translateY(-1px);
}

.logout-btn:active{
  transform: scale(0.98);
}
 #registerBox h2{
  display: flex;
  align-items: center;
  gap: 8px;
}

#registerBox h2 i{
  color: #00e676;
} 
 .input-icon{
  position: relative;
  width: 100%;
  margin-bottom: 14px;
}

.input-icon i{
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: #00e676;
  font-size: 16px;
}

.input-icon input{
  width: 100%;
  padding: 12px 40px 12px 12px;
  border-radius: 10px;
  border: 1px solid #2a2a2a;
  background: #111;
  color: #fff;
  font-size: 14px;
}

/* Ø£Ø²Ø±Ø§Ø± */
.primary-btn{
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 12px;
  background: linear-gradient(135deg,#00e676,#00c853);
  border: none;
  color: #000;
  font-weight: bold;
  cursor: pointer;
}

.secondary-btn{
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  background: transparent;
  border: 1px solid #333;
  color: #ccc;
  border-radius: 12px;
  cursor: pointer;
} 
 .trust-box{
  background: #0f3d2e;
  color: #eafff3;
  padding: 18px;
  border-radius: 12px;
  margin-bottom: 20px;
  font-size: 14px;
  line-height: 1.9;
  border-right: 4px solid #2ecc71;
}

.trust-box i{
  font-size: 24px;
  margin-bottom: 10px;
  display: block;
  color: #2ecc71;
}
</style>
</head>
<body>

<!-- ================= AUTH ================= -->
<div class="box" id="authBox">
  <h2>ğŸ” MaliApp</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="openRegister()">ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</button>
  <button onclick="login()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- ================= REGISTER ================= -->
<div class="box hidden" id="registerBox">
<h2>
  <i class="fa-solid fa-user-plus"></i>
  Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
</h2>
  <div class="input-icon">
  <i class="fa-solid fa-envelope"></i>
  <input id="regEmail" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
</div>

<div class="input-icon">
  <i class="fa-solid fa-phone"></i>
  <input id="regPhone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
</div>

<div class="input-icon">
  <i class="fa-solid fa-lock"></i>
  <input id="regPassword" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
</div>

<div class="input-icon">
  <i class="fa-solid fa-lock"></i>
  <input id="regConfirm" type="password" placeholder="ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
</div>

<button onclick="submitRegister()" class="primary-btn">
  <i class="fa-solid fa-user-plus"></i>
  ØªØ³Ø¬ÙŠÙ„
</button>

<button onclick="backToLogin()" class="secondary-btn">
  <i class="fa-solid fa-arrow-right"></i>
  Ø±Ø¬ÙˆØ¹
</button>
</div>
<!-- ================= APP ================= -->
<div class="box hidden" id="appBox">

  <!-- BALANCE -->
  <div class="balance-card">
    <i class="fa-solid fa-wallet"></i>
    <div class="balance-info">
      <span class="balance-label">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­</span>
      <span class="balance-value">
        <span id="balance">0</span>
        <small>USD</small>
      </span>
    </div>
  </div>

  <!-- LEVEL -->
  <div class="level-box">
    <i class="fa-solid fa-crown level-icon"></i>
    <div class="level-info">
      <div class="level-number">LEVEL <span id="level">1</span></div>
      <div class="level-name" id="levelName">Bronze Member</div>
      <div class="level-bar">
        <span id="levelBar"></span>
      </div>
    </div>
  </div>
  
  <button onclick="openMyBets()" style="margin-top:10px">
    <i class="fa-solid fa-ticket"></i> Ø±Ù‡Ø§Ù†Ø§ØªÙŠ
  </button>

  <!-- MATCHES -->
  <div class="section-title">
    <div class="title-left">
      <i class="fa-solid fa-futbol"></i>
      <span>Ù…ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„ÙŠÙˆÙ…</span>
    </div>
    <span class="live-dot">LIVE</span>
  </div>

  <div id="matchesBox"></div>

</div>
<!-- ================= MY BETS ================= -->
<div class="box hidden" id="myBetsBox">

  <button onclick="goBack('appBox')" class="back-btn">
    <i class="fa-solid fa-arrow-left"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø©
  </button>

  <h3 class="upgrade-title">
    <i class="fa-solid fa-ticket"></i>
    Ø±Ù‡Ø§Ù†Ø§ØªÙŠ
  </h3>

  <div id="myBetsList"></div>

</div>

<!-- ================= PROFILE ================= -->
<div class="box hidden" id="profileBox">

  <button onclick="goBack('appBox')" class="back-btn">
    <i class="fa-solid fa-arrow-left"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø©
  </button>

  <div class="profile-header">
    <div class="avatar">
      <i class="fa-solid fa-user"></i>
    </div>

    <div class="profile-info">
      <div class="profile-name" id="profileName">User</div>
      <div class="profile-id">ID: <span id="profileId">---</span></div>
      <div class="profile-level">
        <i class="fa-solid fa-crown"></i>
        <span id="profileLevel">Bronze Member</span>
      </div>
    </div>
  </div>

  <div class="profile-stats">
    <div class="stat">
      <span class="stat-number" id="statInvites">0</span>
      <span class="stat-label">Ø§Ù„Ø¯Ø¹ÙˆØ§Øª</span>
    </div>
  </div>
  <div class="stat">
  <span class="stat-number" id="winBetsCount">0</span>
  <span class="stat-label">Ø±Ù‡Ø§Ù†Ø§Øª Ø±Ø§Ø¨Ø­Ø©</span>
</div>
 <div class="profile-section">
<h4 class="section-title-text">Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</h4>
    <p class="section-subtext">
  Ø´Ø§Ø±Ùƒ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø²Ø§ÙŠØ§ Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù†Ø¯ ØªØ³Ø¬ÙŠÙ„Ù‡Ù….
</p>
    <div class="referral-box">
      <input id="referralLink" readonly>
      <button onclick="copyReferral()">Ù†Ø³Ø®</button>
    </div>
  </div>
  <div class="profile-actions">
    <button onclick="openTopUp()">
      <i class="fa-solid fa-wallet"></i>
      ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
    </button>
   <button onclick="openUpgradeLevels()">
  <i class="fa-solid fa-arrow-up-wide-short"></i>
  ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰
</button>

    <button onclick="openWithdraw()">
      <i class="fa-solid fa-money-bill-wave"></i>
      Ø·Ù„Ø¨ Ø³Ø­Ø¨
    </button>
  </div>


<div class="profile-logout">
  <button onclick="logoutUser()" class="logout-btn">
    <i class="fa-solid fa-right-from-bracket"></i>
    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
  </button>
</div>
</div>

<!-- ================= WITHDRAW ================= -->
<div class="box hidden" id="withdrawBox">

  <button onclick="goBack('profileBox')" class="back-btn">
    <i class="fa-solid fa-arrow-left"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø©
  </button>

  <h3 class="upgrade-title">
    <i class="fa-solid fa-money-bill-transfer"></i>
    Ø·Ù„Ø¨ Ø³Ø­Ø¨
  </h3>

  <div class="topup-card">
   <p>
  <i class="fa-solid fa-wallet"></i>
  Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø­ Ù„Ù„Ø³Ø­Ø¨
</p>
    <h2><span id="withdrawBalance">0</span> USDT</h2>
    <p class="warning">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨: 20 USDT</p>
  </div>

  <!-- ğŸ”¥ ÙÙˆØ±Ù… Ø§Ù„Ø³Ø­Ø¨ -->
  <div class="topup-card" style="margin-top:15px">

    <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨</label>
    <select id="withdrawMethod">
      <option value="USDT_TRC20">USDT (TRC20)</option>
    </select>

    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©</label>
    <input id="withdrawAddress" placeholder="TXxxxxxxxxxxxxxxxxxxxx">

    <label>Ø§Ù„Ù…Ø¨Ù„Øº</label>
    <input id="withdrawAmount" type="number" placeholder="Ù…Ø«Ø§Ù„: 50">

    <div class="wallet-address">
      Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©: <strong>2 USDT</strong><br>
      Ø§Ù„ØµØ§ÙÙŠ: <strong id="withdrawNet">0 USDT</strong>
    </div>

  <div class="withdraw-agree-center">
  <input type="checkbox" id="agreeWithdraw">
  <label for="agreeWithdraw">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ø³Ø­Ø¨</label>
</div> 
    
   <button class="topup-btn" id="withdrawBtn" onclick="submitWithdraw()">
  <i class="fa-solid fa-paper-plane"></i>
  Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨
</button>

  </div>

  <!-- âœ… Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­Ø¨ (Ù‡Ù†Ø§ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­) -->
  <div class="withdraw-history" style="margin-top:20px">
<h4>
  <i class="fa-solid fa-clock-rotate-left"></i>
  Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
</h4>
<div id="withdrawList"></div>
  </div>

</div>

<!-- âœ… Ø´Ø§Ø´Ø© Ø§Ù„Ù†Ø¬Ø§Ø­ -->
<div class="box hidden" id="withdrawSuccess">
  <h3>âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨</h3>
  <p style="line-height:1.6;opacity:.9">

    ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨ Ø¨Ù†Ø¬Ø§Ø­.<br>
    Ø³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ Ø®Ù„Ø§Ù„
    <strong>72 Ø³Ø§Ø¹Ø© ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰</strong>.
  </p>

  <button class="topup-btn" onclick="goBack('profileBox')">
    Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙˆÙÙŠÙ„
  </button>
</div>

<!-- ================= UPGRADE LEVELS ================= -->
<div class="box hidden" id="upgradeLevelsBox">

  <button onclick="goBack('profileBox')" class="back-btn">
    <i class="fa-solid fa-arrow-left"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø©
  </button>

  <h3 class="upgrade-title">
    <i class="fa-solid fa-crown"></i>
    ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰
  </h3>

  <div class="levels-list" id="levelsList"></div>

</div>

<!-- ================= TOP UP ================= -->
<div class="box hidden" id="topUpBox">
  <button onclick="goBack('profileBox')" class="back-btn">
    <i class="fa-solid fa-arrow-left"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø©
  </button>

  <h3 class="upgrade-title">
    <i class="fa-solid fa-wallet"></i>
    ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø­Ø³Ø§Ø¨
  </h3>

  <div class="topup-card">
    <img class="qr"
      src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=TE3THEisH6nttHBWtJiKpreaxvPGt5sZVW">
    <div class="wallet-address">TE3THEisH6nttHBWtJiKpreaxvPGt5sZVW</div>
    <button onclick="copyAddress()" class="copy-btn">
      <i class="fa-solid fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    </button>
  </div>
</div>
  <!-- ================= REWARDS ================= -->
<div class="box hidden" id="rewardsBox">

  <button onclick="goBack('appBox')" class="back-btn">
    <i class="fa-solid fa-arrow-left"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø©
  </button>

  <h3 class="upgrade-title">
    <i class="fa-solid fa-gift"></i>
    Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²
  </h3>

 <!-- Ø¯Ø¹ÙˆØ§Øª -->
<div class="level-card">
  <h4><i class="fa-solid fa-users"></i> Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h4>

  <p>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1 âœ <strong>5 USD</strong> Ù„ÙƒÙ„ Ø´Ø®Øµ</p>
  <p>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 2 âœ <strong>10 USD</strong> Ù„ÙƒÙ„ Ø´Ø®Øµ</p>
  <p>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 3 âœ <strong>25 USD</strong> Ù„ÙƒÙ„ Ø´Ø®Øµ</p>
  <p>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 4 âœ <strong>50 USD</strong> Ù„ÙƒÙ„ Ø´Ø®Øµ</p>
  <p>Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 5 âœ <strong>80 USD</strong> Ù„ÙƒÙ„ Ø´Ø®Øµ</p>

  <p style="margin-top:8px">
    Ø§Ù„Ø¯Ø¹ÙˆØ§Øª Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø©: <strong id="activeInvites">0</strong>
  </p>
</div>

  <!-- Ø¬Ø§Ø¦Ø²Ø© 100 -->
  <div class="level-card">
    <h4>ğŸ† Ø¬Ø§Ø¦Ø²Ø© 100 USD</h4>
    <p>âœ”ï¸ Ø¯Ø¹ÙˆØ© 10 Ø£Ø´Ø®Ø§Øµ</p>
    <p>âœ”ï¸ ÙƒÙ„Ù‡Ù… Ù…Ø³ØªÙˆÙ‰ 1 Ø£Ùˆ Ø£ÙƒØ«Ø±</p>

    <p>
      Ø§Ù„ØªÙ‚Ø¯Ù…:
      <strong><span id="inviteProgress">0</span>/10</strong>
    </p>

    <button id="claimBigReward" class="upgrade-btn" disabled>
      ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø¨Ø¹Ø¯
    </button>
  </div>

</div>
<div class="box hidden" id="infoBox">

  <button onclick="goBack('appBox')" class="back-btn">
    <i class="fa-solid fa-arrow-left"></i>
    Ø§Ù„Ø¹ÙˆØ¯Ø©
  </button>

  <h3 class="upgrade-title">
    <i class="fa-solid fa-circle-info"></i>
    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  </h3>
<div class="trust-box">
  <i class="fa-solid fa-scale-balanced"></i>
  <p>
    <br>
    Ù‡Ø°Ø§ <strong>ØªØ·Ø¨ÙŠÙ‚ Ø±Ù‡Ù†Ø§Øª ÙˆØªÙƒÙ‡Ù‘Ù†Ø§Øª</strong>ØŒ  
    Ù„ÙƒÙ† Ø¨Ø¹ÙƒØ³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ÙˆÙ‡Ù…ÙŠØ©ØŒ Ù†Ø­Ù† <strong>Ù…Ø§ Ù†Ø±Ø¨Ø­ÙˆØ´ Ø¶Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</strong>.<br><br>

    Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¹Ù†Ø¯Ù†Ø§ Ø¨Ø³ÙŠØ·Ø©:
    <strong>Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø®Ø³Ø± â†’ Ù†Ø­Ù† Ù†Ø®Ø³Ø±</strong><br>
    <strong>ÙˆØ¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø±Ø¨Ø­ â†’ Ù†Ø±Ø¨Ø­Ùˆ Ù…Ø¹Ø§Ù‡</strong>.<br><br>

    Ù…Ø§ ÙÙ…Ø§ Ø­ØªÙ‰ Ù…ØµÙ„Ø­Ø© Ù„ÙŠÙ†Ø§ ÙÙŠ Ø®Ø³Ø§Ø±ØªÙƒØŒ
    ÙˆÙ†Ø¬Ø§Ø­Ùƒ Ù‡Ùˆ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„ÙˆØ­ÙŠØ¯ Ù„ÙˆØ¬ÙˆØ¯ Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚.
    Ø§Ù„Ø«Ù‚Ø© ÙˆØ§Ù„ÙˆØ¶ÙˆØ­ Ø£Ù‡Ù… Ø¹Ù†Ø¯Ù†Ø§ Ù…Ù† Ø£ÙŠ Ø±Ø¨Ø­ Ø³Ø±ÙŠØ¹.
  </p>
</div>
  <div class="level-card">
    <h4>
      <i class="fa-solid fa-mobile-screen-button"></i>
      Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    </h4>
    <p>
      Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø®ØµØµ Ù„Ù„ØªÙƒÙ‡Ù†Ø§Øª ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©.
      Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†.
    </p>
  </div>

  <div class="level-card">
    <h4>
      <i class="fa-solid fa-file-contract"></i>
      Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…
    </h4>
    <p>
      â€¢ ÙŠÙ…Ù†Ø¹ Ø¥Ù†Ø´Ø§Ø¡ Ø£ÙƒØ«Ø± Ù…Ù† Ø­Ø³Ø§Ø¨ ÙˆØ§Ø­Ø¯<br>
      â€¢ Ø£ÙŠ ØªØ­Ø§ÙŠÙ„ ÙŠØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ Ø­Ø¸Ø± Ø§Ù„Ø­Ø³Ø§Ø¨<br>
      â€¢ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨ ØªØ®Ø¶Ø¹ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©
    </p>
  </div>

  <div class="level-card">
    <h4>
      <i class="fa-solid fa-shield-halved"></i>
      Ø§Ù„Ø®ØµÙˆØµÙŠØ©
    </h4>
    <p>
      Ù„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ Ø£ÙŠ Ø·Ø±Ù Ø«Ø§Ù„Ø«.
    </p>
  </div>

</div>
<!-- ================= NAV BAR ================= -->
<div id="navBar" class="bottom-bar hidden">
  <button onclick="openInfo()" class="nav-item">
  <i class="fa-solid fa-circle-info"></i>
  <span>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</span>
</button>

  <button onclick="openTab(this,'profileBox')">
    <i class="fa-solid fa-user"></i><span>Ø¨Ø±ÙˆÙÙŠÙ„</span>
  </button>

  <button class="center-btn" onclick="openTab(this,'appBox')">
    <i class="fa-solid fa-futbol"></i>
  </button>

<button onclick="openRewards()">
  <i class="fa-solid fa-gift"></i><span>Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²</span>
</button>
<button onclick="openSupport()">
  <i class="fa-solid fa-headset"></i>
  <span>Ø§Ù„Ø¯Ø¹Ù…</span>
</button>
  </div>
<script type="module">
/* ================= IMPORTS ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";

import {
  getAuth,
  createUserWithEmailAndPassword,
  signInWithEmailAndPassword,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
  getFirestore,
  doc,
  setDoc,
  getDoc,
  updateDoc,
  collection,
  query,
  where,
  serverTimestamp,
  getDocs,
  onSnapshot,
  addDoc,
  orderBy,
  increment,
  runTransaction   // âœ… Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø¶Ø¨Ø·
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
/* ================= FIREBASE ================= */
const firebaseConfig = {
  apiKey: "AIzaSyBfMUa-8vsUZ_1r5F79iSKOKqMre99lwbI",
  authDomain: "maliapp-63f91.firebaseapp.com",
  projectId: "maliapp-63f91"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
 
function watchMatchesResults() {
  const q = collection(db, "matches");

  onSnapshot(q, async (snap) => {
    for (const docSnap of snap.docs) {
      const match = docSnap.data();
      const matchId = docSnap.id;

      // â›” Ù„Ø§ Ù†ØªÙŠØ¬Ø©
      if (!match.result) continue;

      // â›” Ù…Ø³ÙˆÙ‘Ø§Ø© Ù…Ù† Ù‚Ø¨Ù„
      if (match.settled === true) continue;

      const betsQ = query(
        collection(db, "bets"),
        where("matchId", "==", matchId),
        where("status", "==", "pending")
      );

      const betsSnap = await getDocs(betsQ);

      for (const betDoc of betsSnap.docs) {
        const bet = betDoc.data();

        // ğŸ”’ Ù…Ø­Ù…ÙŠ
        if (bet.rewarded === true) continue;

        const isWin = bet.choice === match.result;
        const newStatus = isWin ? "win" : "lose";

        await updateDoc(betDoc.ref, {
          status: newStatus,
          settled: true
        });

        if (isWin) {
          const userRef = doc(db, "users", bet.userId);

          await runTransaction(db, async (tx) => {
            const snapUser = await tx.get(userRef);
            if (!snapUser.exists()) return;

            const user = snapUser.data();

            const rewards = {
              1: 0.5,
              2: 1,
              3: 2,
              4: 3.5,
              5: 5
            };

            const reward = rewards[user.level] || 0;

            tx.update(userRef, {
              balance: (user.balance || 0) + reward,
              winCount: increment(1)
            });

            // ğŸ”’ Ù‚ÙÙ„ Ù†Ù‡Ø§Ø¦ÙŠ
            tx.update(betDoc.ref, {
              rewarded: true
            });
          });
        }
      }
    }
  });
}
/* ================= GLOBAL ================= */
let unsubscribeWinBets = null;
  let unsubscribeMyBets = null; 
let currentView = "authBox";
let userData = {};
let matches = [];
window.openSupport = function () {
  window.open("https://t.me/maliapp_support", "_blank");
};
/* ================= VIEW SYSTEM (Ø§Ù„Ù…Ù‡Ù…) ================= */
function showView(id){
  currentView = id;

  document.querySelectorAll(".box").forEach(b=>{
    b.classList.add("hidden");
  });

  const el = document.getElementById(id);
  if(el){
    el.classList.remove("hidden");
  }
}

window.goBack = function(target){
  showView(target || "appBox");
};

window.openTab = function(btn, viewId){
  document.querySelectorAll(".bottom-bar button")
    .forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");

  showView(viewId);

  // âœ… Ø§Ù„Ø­Ù„ Ù‡Ù†Ø§
  if (viewId === "profileBox") {
    updateProfileUI();
    loadRewards(); // ğŸ‘ˆ Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­
  }

  if (viewId === "rewardsBox") {
    loadRewards();
  }
};

/* ================= DOM ================= */
const balance = document.getElementById("balance");
const level = document.getElementById("level");
const levelName = document.getElementById("levelName");
const levelBar = document.getElementById("levelBar");
const matchesBox = document.getElementById("matchesBox");
const navBar = document.getElementById("navBar");
 const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password"); 
/* ===== PROFILE DOM ===== */
const profileName = document.getElementById("profileName");
const profileLevel = document.getElementById("profileLevel");
const referralLink = document.getElementById("referralLink");
const withdrawBalance = document.getElementById("withdrawBalance");
const winBetsCount = document.getElementById("winBetsCount");
  /* ================= UI ================= */
function updateUI(){
  const bal = Number(userData.balance || 0);

  balance.innerText = bal.toFixed(2);
  withdrawBalance.innerText = bal.toFixed(2);

  updateLevelUI();
}

function updateLevelUI(){
  const lvl = userData.level ?? 0;

  const names = {
    0: "Locked",
    1: "Bronze Member",
    2: "Silver Member",
    3: "Gold Member",
    4: "Platinum Member"
  };

  const progress = {
    0: "0%",
    1: "25%",
    2: "50%",
    3: "75%",
    4: "100%"
  };

  level.innerText = lvl;
  levelName.innerText = names[lvl];
  levelBar.style.width = progress[lvl];
}

/* ================= AUTH ================= */
window.openRegister = ()=> showView("registerBox");
window.backToLogin  = ()=> showView("authBox");

window.submitRegister = async ()=>{
  try{
    const email = regEmail.value.trim();
    const phone = regPhone.value.trim();
    const pass  = regPassword.value;
    const conf  = regConfirm.value;

    if(!email || !phone || pass !== conf){
      alert("âŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
      return;
    }

    const params = new URLSearchParams(window.location.search);
    const ref = params.get("ref");

    const cred = await createUserWithEmailAndPassword(auth, email, pass);

await setDoc(doc(db,"users",cred.user.uid),{
  email,
  phone,
  level: 0,
  balance: 0,          // âœ… Ø¶Ø±ÙˆØ±ÙŠ
  winCount: 0,
  referredBy: ref || null,

  // âœ… Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ù‡Ù…
  lastRewardedLevel: 0,

  bigRewardClaimed: false,
  createdAt: serverTimestamp()
});
    showView("appBox");
    fetchMatches();

  }catch(e){
    console.error(e);
    alert(e.message);
  }
};
  /* ================= LOGIN ================= */
window.login = async ()=>{
  try{
    const email = emailInput.value.trim();
    const password = passwordInput.value;

    if(!email || !password){
      alert("âŒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
      return;
    }

    await signInWithEmailAndPassword(auth, email, password);

    showView("appBox");
    fetchMatches();

  }catch(e){
    alert("âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
    console.error(e);
  }
};
/* ================= AUTH STATE ================= */
onAuthStateChanged(auth, async (user)=>{
  if(!user){
    navBar.classList.add("hidden");
    showView("authBox");
    return;
  }

  navBar.classList.remove("hidden");

  watchUserData(user.uid); // âœ… Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­

  loadWinBetsCount();
  watchMatchesResults();
  fetchMatches();

  showView("appBox");
});
 let unsubscribeUser = null;

function watchUserData(uid) {
  const userRef = doc(db, "users", uid);

  if (unsubscribeUser) unsubscribeUser();

  unsubscribeUser = onSnapshot(userRef, (snap) => {
    if (!snap.exists()) return;

    userData = snap.data();

    updateUI();
    updateProfileUI();
  });
} 
  window.openRewards = async () => {
  showView("rewardsBox");
  await loadRewards();
};

async function loadRewards() {
  const uid = auth.currentUser.uid;

  const q = query(
    collection(db, "users"),
    where("referredBy", "==", uid)
  );

  const snap = await getDocs(q);

  let totalInvites = snap.size; // ğŸ‘ˆ ÙƒÙ„ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª
  let active = 0;               // ğŸ‘ˆ ÙÙ‚Ø· Ø§Ù„Ù…ÙØ¹Ù‘Ù„Ø©

  snap.forEach(d => {
    const u = d.data();
    if ((u.level || 0) >= 1) active++;
  });

  // ØµÙØ­Ø© Ø§Ù„Ø¬ÙˆØ§Ø¦Ø²
  document.getElementById("activeInvites").innerText = active;
  document.getElementById("inviteProgress").innerText = active;

  // ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙÙŠÙ„
  const stat = document.getElementById("statInvites");
  if (stat) stat.innerText = totalInvites;

  const btn = document.getElementById("claimBigReward");

  if (active >= 10 && !userData.bigRewardClaimed) {
    btn.disabled = false;
    btn.innerText = "ØªØ­ØµÙŠÙ„ 100 USD";
    btn.onclick = claimBigReward;
  } else if (userData.bigRewardClaimed) {
    btn.innerText = "ØªÙ… Ø§Ù„ØªØ­ØµÙŠÙ„ âœ”ï¸";
    btn.disabled = true;
  }
}
  async function claimBigReward() {
  if (userData.bigRewardClaimed) return;

  const ok = confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­ØµÙŠÙ„ Ø¬Ø§Ø¦Ø²Ø© 100 USDØŸ");
  if (!ok) return;

  const userRef = doc(db, "users", auth.currentUser.uid);

  await updateDoc(userRef, {
    balance: (userData.balance || 0) + 100,
    bigRewardClaimed: true
  });

  userData.balance += 100;
  userData.bigRewardClaimed = true;

  updateUI();
  alert("ğŸ‰ ØªÙ… Ø¥Ø¶Ø§ÙØ© 100 USD Ø¥Ù„Ù‰ Ø±ØµÙŠØ¯Ùƒ");
  loadRewards();
}
const referralRewardsByLevel = {
  1: 5,
  2: 10,
  3: 15,
  4: 20,
  5: 30
};
window.upgradeLevel = async (targetLevel, price) => {
  const currentLevel = Number(userData.level) || 0;
  const currentBalance = Number(userData.balance) || 0;

  if (targetLevel <= currentLevel) {
    alert("âŒ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ù…ÙØ¹Ù‘Ù„ Ø¨Ø§Ù„ÙØ¹Ù„");
    return;
  }

  if (currentBalance < price) {
    alert("âŒ Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ");
    return;
  }

  if (!confirm(`ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ ${targetLevel} Ù…Ù‚Ø§Ø¨Ù„ ${price} USDØŸ`)) return;

  try {
    const userRef = doc(db, "users", auth.currentUser.uid);

    await runTransaction(db, async (tx) => {
      const userSnap = await tx.get(userRef);
      if (!userSnap.exists()) throw "user-not-found";

      const user = userSnap.data();

      // ğŸ”’ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      tx.update(userRef, {
        level: targetLevel,
        balance: (user.balance || 0) - price
      });

      // ğŸ Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¥Ø­Ø§Ù„Ø© (Ø¨Ø¯ÙˆÙ† Ù‚Ø±Ø§Ø¡Ø© inviter)
      if (user.referredBy) {
        const reward = referralRewardsByLevel[targetLevel] || 0;

        if (reward > 0) {
          const inviterRef = doc(db, "users", user.referredBy);
          tx.update(inviterRef, {
            balance: increment(reward)
          });
        }
      }
    });

    // ØªØ­Ø¯ÙŠØ« Ù…Ø­Ù„ÙŠ
    userData.level = targetLevel;
    userData.balance = currentBalance - price;

    updateUI();
    updateProfileUI();
    renderLevels();

    alert("âœ… ØªÙ…Øª Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­ ğŸ‰");

  } catch (e) {
    console.error("UPGRADE ERROR:", e);
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ±Ù‚ÙŠØ©");
  }
};
/* ================= PROFILE ================= */
function updateProfileUI(){
  profileName.innerText = userData.email;
  profileLevel.innerText = levelName.innerText;

  const uid = auth.currentUser?.uid;
  if (uid) {
    referralLink.value =
      `${location.origin}${location.pathname}?ref=${uid}`;
  }
}
function loadWinBetsCount() {
  if (!auth.currentUser) return;

  const q = query(
    collection(db, "bets"),
    where("userId", "==", auth.currentUser.uid)
  );

  if (unsubscribeWinBets) unsubscribeWinBets();

  unsubscribeWinBets = onSnapshot(q, (snap) => {
    let count = 0;

    snap.forEach(doc => {
      const b = doc.data();
      if ((b.status || "").trim().toLowerCase() === "win") {
        count++;
      }
    });

    userData.winCount = count;
winBetsCount.innerText = count;
// âŒ Ù…Ø§ ØªÙ…Ø³Ù‘Ø´ Ø§Ù„Ø±ØµÙŠØ¯ Ù‡Ù†Ø§
  });
}
window.logoutUser = function () {
  if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) return;

  signOut(auth)
    .then(() => {
      navBar.classList.add("hidden");
      showView("authBox");
    })
    .catch(error => {
      alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
      console.error(error);
    });
};

  /* ================= UPGRADE LEVELS ================= */

const levelsData = [
  { level: 1, reward: "0.5 USD", price: 150 },
  { level: 2, reward: "1 USD",   price: 295 },
  { level: 3, reward: "2 USD",   price: 590 },
  { level: 4, reward: "3.5 USD", price: 1000 },
  { level: 5, reward: "5 USD",   price: 1450 },
  { level: 6, coming: true },
  { level: 7, coming: true },
  { level: 8, coming: true },
  { level: 9, unavailable: true },
  { level: 10, unavailable: true }
];

window.openUpgradeLevels = () => {
  renderLevels();
  showView("upgradeLevelsBox");
};

function renderLevels() {
  const container = document.getElementById("levelsList");
  const currentLevel = Number(userData.level) || 0;

  container.innerHTML = "";

  levelsData.forEach(l => {

    if (l.coming) {
      container.innerHTML += `
        <div class="level-card coming">
          <h4>Ù…Ø³ØªÙˆÙ‰ ${l.level}</h4>
          <span class="tag">Ù‚ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</span>
        </div>
      `;
      return;
    }

    if (l.unavailable) {
      container.innerHTML += `
        <div class="level-card locked">
          <h4>Ù…Ø³ØªÙˆÙ‰ ${l.level}</h4>
          <span class="tag">ØºÙŠØ± Ù…ØªÙˆÙØ± Ø§Ù„Ø¢Ù†</span>
        </div>
      `;
      return;
    }

    const isCurrent = l.level === currentLevel;
    const canUpgrade = l.level > currentLevel;

    let actionHtml = "";
    if (isCurrent) {
      actionHtml = `<span class="tag active">Ù…Ø³ØªÙˆØ§Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</span>`;
    } else if (canUpgrade) {
      actionHtml = `
        <button class="upgrade-btn"
          onclick="upgradeLevel(${l.level}, ${l.price})">
          ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø¢Ù†
        </button>
      `;
    } else {
      actionHtml = `<span class="tag locked">ØºÙŠØ± Ù…ØªØ§Ø­</span>`;
    }

    container.innerHTML += `
      <div class="level-card ${isCurrent ? "active" : ""}">
        <h4>Ù…Ø³ØªÙˆÙ‰ ${l.level}</h4>

        <div class="reward-box">
          <i class="fa-solid fa-money-bill-wave"></i>
          <span>${l.reward} Ù„ÙƒÙ„ ØªÙƒÙ‡Ù‘Ù† ØµØ­ÙŠØ­</span>
        </div>

        <div class="price-box">
          <i class="fa-solid fa-tag"></i>
          <span>Ø³Ø¹Ø± Ø§Ù„ØªØ±Ù‚ÙŠØ©: ${l.price} USD</span>
        </div>

        ${actionHtml}
      </div>
    `;
  });
}
  /* ================= WITHDRAW HISTORY ================= */
function loadWithdrawHistory() {
  const box = document.getElementById("withdrawList");
  box.innerHTML = "â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„...";

  const q = query(
    collection(db, "withdrawals"),
    where("userId", "==", auth.currentUser.uid)
  );

  // âœ… Firestore global onSnapshot
  onSnapshot(q, (snap) => {
    box.innerHTML = "";

    if (snap.empty) {
      box.innerHTML = "<p>ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø­Ø¨</p>";
      return;
    }

    snap.forEach(docSnap => {
      const w = docSnap.data();

      let statusText = "â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©";
      let statusClass = "pending";

     const status = (w.status || "").trim().toLowerCase();

if (status === "approved") {
  statusText = "âœ… ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„";
  statusClass = "approved";
}

if (status === "rejected") {
  statusText = "âŒ Ù…Ø±ÙÙˆØ¶";
  statusClass = "rejected";
}

box.innerHTML += `
  <div class="withdraw-item ${statusClass}">
    <div class="withdraw-left">
      <div class="amount">
        <i class="fa-solid fa-coins"></i>
        ${w.amount} USDT
      </div>
      <small class="date">
        <i class="fa-regular fa-clock"></i>
        ${w.createdAt?.toDate().toLocaleString("ar-TN") || ""}
      </small>
    </div>

    <div class="withdraw-status ${statusClass}">
      ${
        statusClass === "approved"
          ? '<i class="fa-solid fa-circle-check"></i> ØªÙ… Ø§Ù„Ù‚Ø¨ÙˆÙ„'
          : statusClass === "rejected"
          ? '<i class="fa-solid fa-circle-xmark"></i> Ù…Ø±ÙÙˆØ¶'
          : '<i class="fa-solid fa-hourglass-half"></i> Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'
      }
    </div>
  </div>
`;
    });
  });
}
/* ================= WITHDRAW ================= */

window.openWithdraw = async ()=>{
  showView("withdrawBox");
  withdrawBalance.innerText = userData.balance ?? 0;

  // âœ… ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø­Ø¨
  await loadWithdrawHistory();
};

// Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø³Ø­Ø¨
window.submitWithdraw = async () => {
  try {
    const amount  = Number(document.getElementById("withdrawAmount").value);
    const method  = document.getElementById("withdrawMethod").value;
    const address = document.getElementById("withdrawAddress").value.trim();
    const agree   = document.getElementById("agreeWithdraw").checked;

    // âœ… Ø§Ù„ØªØ­Ù‚Ù‚
    if (!amount || amount < 20) {
      alert("âŒ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø³Ø­Ø¨ Ù‡Ùˆ 20 USDT");
      return;
    }

    if (amount > (userData.balance || 0)) {
      alert("âŒ Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§Ù");
      return;
    }

    if (!address) {
      alert("âŒ Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©");
      return;
    }

    if (!agree) {
      alert("âŒ ÙŠØ¬Ø¨ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ø³Ø­Ø¨");
      return;
    }

    const btn = document.getElementById("withdrawBtn");
    btn.disabled = true;
    btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...";

    // ğŸ§¾ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Firestore
    await addDoc(collection(db, "withdrawals"), {
      userId: auth.currentUser.uid,
      amount: amount,
      fee: 2,
      netAmount: Math.max(amount - 2, 0),
      method: method,
      address: address,
      status: "pending", // pending | approved | rejected
      createdAt: serverTimestamp()
    });

    // ğŸ’° Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    await updateDoc(doc(db, "users", auth.currentUser.uid), {
      balance: (userData.balance || 0) - amount
    });

    userData.balance -= amount;
    updateUI();

    // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
    await loadWithdrawHistory();

    // ğŸ‰ ØµÙØ­Ø© Ù†Ø¬Ø§Ø­ Ø§Ø­ØªØ±Ø§ÙÙŠØ©
    showView("withdrawSuccess");

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙˆØ±Ù…
    document.getElementById("withdrawAmount").value = "";
    document.getElementById("withdrawAddress").value = "";
    document.getElementById("agreeWithdraw").checked = false;
    document.getElementById("withdrawNet").innerText = "0 USDT";

    btn.disabled = false;
    btn.innerText = "ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø­Ø¨";

  } catch (e) {
    console.error("ğŸ”¥ WITHDRAW ERROR:", e);
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨");
  }
};

/* ================= TOP UP ================= */
window.openTopUp = ()=> showView("topUpBox");
 window.openInfo = () => {
  showView("infoBox");
}; 
/* ================= COPY TOP UP ADDRESS ================= */
window.copyAddress = async function () {
  const addressEl = document.querySelector("#topUpBox .wallet-address");
  if (!addressEl) {
    alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†");
    return;
  }

  const address = addressEl.innerText.trim();

  try {
    await navigator.clipboard.writeText(address);
    alert("âœ… ØªÙ… Ù†Ø³Ø® Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­");
  } catch (e) {
    // fallback Ù„Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
    const tempInput = document.createElement("input");
    tempInput.value = address;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand("copy");
    document.body.removeChild(tempInput);
    alert("âœ… ØªÙ… Ù†Ø³Ø® Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©");
  }
};
  /* ================= COPY REFERRAL LINK ================= */
window.copyReferral = async function () {
  const input = document.getElementById("referralLink");

  if (!input || !input.value) {
    alert("âŒ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© ØºÙŠØ± Ù…ØªÙˆÙØ±");
    return;
  }

  try {
    await navigator.clipboard.writeText(input.value);
    alert("âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø¨Ù†Ø¬Ø§Ø­");
  } catch (e) {
    // fallback
    input.select();
    document.execCommand("copy");
    alert("âœ… ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©");
  }
};
function toUTC(date) {
  return new Date(
    date.getUTCFullYear(),
    date.getUTCMonth(),
    date.getUTCDate(),
    date.getUTCHours(),
    date.getUTCMinutes(),
    date.getUTCSeconds()
  );
} 
/* ================= MATCHES ================= */
async function fetchMatches(){
  matchesBox.innerHTML = "â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª...";
  matches = [];

  const snap = await getDocs(collection(db,"matches"));
  snap.forEach(d=>{
    matches.push({
      id: d.id,
      ...d.data()
    });
  });

  loadMatches();
}

function loadMatches(){
  matchesBox.innerHTML = "";

  const lvl = Number(userData.level ?? 0);
  const locked = lvl === 0;
matches.forEach(m => {

  const nowUTC = toUTC(new Date());
const matchStart = m.startTime
  ? new Date(m.startTime.replace(" ", "T"))
  : null;
  const matchUTC = matchStart ? toUTC(matchStart) : null;

  let timeHtml = "";
  let statusBadge = "";

  if (matchStart) {
    const timeStr = matchStart.toLocaleTimeString("ar-TN", {
      hour: "2-digit",
      minute: "2-digit"
    });

    const dateStr = matchStart.toLocaleDateString("ar-TN", {
      weekday: "short",
      day: "numeric",
      month: "short"
    });

    if (nowUTC < matchUTC) {
      statusBadge = `<span class="badge upcoming">Ù‚Ø§Ø¯Ù…Ø©</span>`;
    } else if (m.settled === true) {
      statusBadge = `<span class="badge finished">Ø§Ù†ØªÙ‡Øª</span>`;
    } else {
      statusBadge = `<span class="live-dot">LIVE</span>`;
    }

    timeHtml = `
      <div class="pro-time">
        <i class="fa-regular fa-clock"></i>
        <span>${dateStr}</span>
        <span class="sep">|</span>
        <span>${timeStr}</span>
      </div>
    `;
  }

  const matchStarted = matchUTC && nowUTC >= matchUTC;


   matchesBox.innerHTML += `
  <div class="match-card">

    <!-- â±ï¸ Ø§Ù„ÙˆÙ‚Øª + Ø§Ù„Ø­Ø§Ù„Ø© -->
    ${timeHtml}
    ${statusBadge}

    <!-- Ø§Ù„ÙØ±Ù‚ -->
    <div class="match-header">
      <div class="team team-left">${m.teamA}</div>
      <div class="vs">VS</div>
      <div class="team team-right">${m.teamB}</div>
    </div>

    <div class="bet-buttons">
      <button class="bet-btn"
        ${locked || matchStarted || m.settled ? "disabled" : ""}
        onclick="placeBet('${m.id}','1',this)">1</button>

      <button class="bet-btn"
        ${locked || matchStarted || m.settled ? "disabled" : ""}
        onclick="placeBet('${m.id}','X',this)">X</button>

      <button class="bet-btn"
        ${locked || matchStarted || m.settled ? "disabled" : ""}
        onclick="placeBet('${m.id}','2',this)">2</button>
    </div>

  </div>
`;
  });
}
/* ================= BET ================= */
window.placeBet = async (matchId, choice, btn) => {
  try {
    // ğŸ”’ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆÙ‰
    const lvl = Number(userData.level) || 0;
    if (lvl === 0) {
      alert("â›” ÙŠØ¬Ø¨ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø£ÙˆÙ„Ù‹Ø§");
      return;
    }

    const user = auth.currentUser;
    if (!user) throw "USER NOT LOGGED";

    // ğŸ”’ Ù†Ø¬ÙŠØ¨ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    const match = matches.find(m => m.id === matchId);
    if (!match) {
      alert("âŒ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©");
      return;
    }

    // ğŸ”’ Ù†Ù…Ù†Ø¹ Ø§Ù„Ø±Ù‡Ø§Ù† Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    if (match.settled === true) {
      alert("âŒ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ù…ØºÙ„Ù‚Ø©");
      return;
    }

    // â±ï¸ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙˆÙ‚Øª (string)
    if (match.startTime) {
      const matchDate = new Date(match.startTime.replace(" ", "T"));
      if (matchDate <= new Date()) {
        alert("â±ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙƒÙ‡Ù‘Ù† Ø¨Ø¹Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©");
        return;
      }
    }

    // ğŸ”’ Ù†Ù…Ù†Ø¹ ØªØºÙŠÙŠØ± Ø§Ù„ØªÙƒÙ‡Ù‘Ù†
    const betRef = doc(db, "bets", `${user.uid}_${matchId}`);
    const betSnap = await getDoc(betRef);

    if (betSnap.exists()) {
      alert("âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„ØªÙƒÙ‡Ù‘Ù†");
      return;
    }

// âœ… Ù†Ø¶ÙŠÙ Ø§Ù„Ø±Ù‡Ø§Ù†
await setDoc(betRef, {
  userId: user.uid,
  matchId: matchId,
  matchName: `${match.teamA} vs ${match.teamB}`,
  choice: choice,
  status: "pending",
  settled: false,
  rewarded: false,   // âœ… Ù…Ù‡Ù…
  createdAt: serverTimestamp()
});

// ğŸš€ ØªØ­Ø¯ÙŠØ« ÙÙˆØ±ÙŠ Ù„Ù„ÙˆØ§Ø¬Ù‡Ø© (Optimistic UI)
matches = matches.map(m =>
  m.id === matchId ? { ...m, userBet: choice } : m
);

loadMatches(); // ğŸ‘ˆ ÙŠØ¹Ø§ÙˆØ¯ ÙŠØ±Ù†Ø¯Ø± Ø§Ù„ÙƒØ±ÙˆØª ÙÙˆØ±Ø§Ù‹

alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙƒÙ‡Ù†");

// ğŸ”• ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø±
if (btn) btn.disabled = true;
  } catch (e) {
    console.error("ğŸ”¥ BET ERROR:", e);

    if (String(e).toLowerCase().includes("permission")) {
      alert("âŒ Firestore Ø±ÙØ¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø±Ø§Ø¬Ø¹ Rules)");
    } else {
      alert("âŒ Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚");
    }
  }
};
/* ================= MY BETS (STABLE) ================= */

window.openMyBets = async ()=>{
  showView("myBetsBox");

  myBetsList.innerHTML = "â³ ØªØ­Ù…ÙŠÙ„...";

  const q = query(
    collection(db, "bets"),
    where("userId", "==", auth.currentUser.uid)
  );

  try {
    const snap = await getDocs(q);

    myBetsList.innerHTML = "";

    if (snap.empty) {
      myBetsList.innerHTML = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ù‡Ø§Ù†Ø§Øª";
      return;
    }

    snap.forEach(docSnap => {
      const bet = docSnap.data();

      const statusClass =
        bet.status === "win"  ? "bet-win"  :
        bet.status === "lose" ? "bet-lose" :
        "bet-pending";

      const statusText =
        bet.status === "win"  ? "âœ… ÙÙˆØ²" :
        bet.status === "lose" ? "âŒ Ø®Ø³Ø§Ø±Ø©" :
        "â³ Ù‚ÙŠØ¯ Ø§Ù„Ù„Ø¹Ø¨";

      myBetsList.innerHTML += `
        <div class="bet-card ${statusClass}">
          <div class="bet-header">
            <span class="bet-match">${bet.matchName}</span>
            <span class="bet-status">${statusText}</span>
          </div>

          <div class="bet-body">
            <div class="bet-item">
              <span class="label">Ø§Ø®ØªÙŠØ§Ø±Ùƒ</span>
              <span class="value">${bet.choice}</span>
            </div>

            <div class="bet-item">
              <span class="label">Ø§Ù„ØªØ§Ø±ÙŠØ®</span>
              <span class="value">
                ${bet.createdAt?.toDate().toLocaleString() || ""}
              </span>
            </div>
          </div>
        </div>
      `;
    });

  } catch (e) {
    console.error(e);
    myBetsList.innerHTML = "âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù‡Ø§Ù†Ø§Øª";
  }
};
/* ================= SUPPORT ================= */
function openSupport(){
  window.open("https://t.me/maliapp_support", "_blank");
} 
/* ================= LOGOUT ================= */
window.logout = async ()=>{
  await signOut(auth);
};
</script>

</body>
</html>
